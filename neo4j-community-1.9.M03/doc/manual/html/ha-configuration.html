<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.2. Setup and configuration</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The Neo4j Manual v1.9.M03" /><link rel="up" href="ha.html" title="Chapter 22. High Availability" /><link rel="prev" href="ha-architecture.html" title="22.1. Architecture" /><link rel="next" href="ha-how.html" title="22.3. How Neo4j HA operates" /><link rel="preface" href="preface.html" title="Preface" /><link rel="part" href="introduction.html" title="Part I. Introduction" /><link rel="chapter" href="introduction-highlights.html" title="Chapter 1. Neo4j Highlights" /><link rel="chapter" href="graphdb-concepts.html" title="Chapter 2. Graph Database Concepts" /><link rel="chapter" href="graphdb-neo4j.html" title="Chapter 3. The Neo4j Graph Database" /><link rel="part" href="tutorials.html" title="Part II. Tutorials" /><link rel="chapter" href="tutorials-java-embedded.html" title="Chapter 4. Using Neo4j embedded in Java applications" /><link rel="chapter" href="tutorials-rest.html" title="Chapter 5. Neo4j Remote Client Libraries" /><link rel="chapter" href="tutorial-traversal.html" title="Chapter 6. The Traversal Framework" /><link rel="chapter" href="data-modeling-examples.html" title="Chapter 7. Data Modeling Examples" /><link rel="chapter" href="languages.html" title="Chapter 8. Languages" /><link rel="chapter" href="tutorials-python-embedded.html" title="Chapter 9. Using Neo4j embedded in Python applications" /><link rel="chapter" href="server-extending.html" title="Chapter 10. Extending the Neo4j Server" /><link rel="part" href="reference-documentation.html" title="Part III. Reference" /><link rel="chapter" href="capabilities.html" title="Chapter 11. Capabilities" /><link rel="chapter" href="transactions.html" title="Chapter 12. Transaction Management" /><link rel="chapter" href="import.html" title="Chapter 13. Data Import" /><link rel="chapter" href="indexing.html" title="Chapter 14. Indexing" /><link rel="chapter" href="cypher-query-lang.html" title="Chapter 15. Cypher Query Language" /><link rel="chapter" href="graph-algo.html" title="Chapter 16. Graph Algorithms" /><link rel="chapter" href="server.html" title="Chapter 17. Neo4j Server" /><link rel="chapter" href="rest-api.html" title="Chapter 18. REST API" /><link rel="chapter" href="python-embedded.html" title="Chapter 19. Python embedded bindings" /><link rel="part" href="operations.html" title="Part IV. Operations" /><link rel="chapter" href="deployment.html" title="Chapter 20. Installation &amp; Deployment" /><link rel="chapter" href="embedded-configuration.html" title="Chapter 21. Configuration &amp; Performance" /><link rel="chapter" href="ha.html" title="Chapter 22. High Availability" /><link rel="chapter" href="operations-backup.html" title="Chapter 23. Backup" /><link rel="chapter" href="operations-security.html" title="Chapter 24. Security" /><link rel="chapter" href="operations-monitoring.html" title="Chapter 25. Monitoring" /><link rel="part" href="tools.html" title="Part V. Tools" /><link rel="chapter" href="tools-webadmin.html" title="Chapter 26. Web Administration" /><link rel="chapter" href="shell.html" title="Chapter 27. Neo4j Shell" /><link rel="part" href="community.html" title="Part VI. Community" /><link rel="chapter" href="community-support.html" title="Chapter 28. Community Support" /><link rel="chapter" href="community-contributing.html" title="Chapter 29. Contributing to Neo4j" /><link rel="appendix" href="manpages.html" title="Appendix A. Manpages" /><link rel="refentry" href="re01.html" title="neo4j" /><link rel="refentry" href="re02.html" title="neo4j-shell" /><link rel="refentry" href="re03.html" title="neo4j-backup" /><link rel="appendix" href="questions.html" title="Appendix B. Questions &amp; Answers" /><link rel="subsection" href="ha-configuration.html#_installation_notes" title="22.2.1. Installation Notes" /><link rel="subsection" href="ha-configuration.html#_different_methods_for_participating_in_a_cluster" title="22.2.2. Different methods for participating in a cluster" /><link rel="copyright" href="ln-idp1051392.html" title="License: Creative Commons 3.0" />


<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushProperties.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->
 
<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>

<!-- Offline Sidebar -->

<script type="text/javascript" src="js/sidebar.js"></script>


<div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">The Neo4j Manual</a></span> &gt; <span class="breadcrumb-link"><a href="operations.html">Operations</a></span> &gt; <span class="breadcrumb-link"><a href="ha.html">High Availability</a></span> &gt; <span class="breadcrumb-node">Setup and configuration</span></div></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ha-architecture.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ha-how.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ha-configuration"></a>22.2. Setup and configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ha-configuration.html#_installation_notes">22.2.1. Installation Notes</a></span></dt><dt><span class="section"><a href="ha-configuration.html#_different_methods_for_participating_in_a_cluster">22.2.2. Different methods for participating in a cluster</a></span></dt></dl></div><p>Neo4j HA can be set up to accommodate differing requirements for load, fault tolerance and available hardware.</p><p>Within a cluster, Neo4j HA uses its own Paxos implementation for all cluster membership related tasks, from instances joining/leaving a cluster to master election and availability information propagation.
Read operations through the <code class="literal">GraphDatabaseService</code> API will always work, whereas write operations requires an available master.</p><p>For reaching quorum among the members in the cluster the number of members should be odd.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_installation_notes"></a>22.2.1. Installation Notes</h3></div></div></div><p>For installation instructions of a High Availability cluster see <a class="xref" href="ha-setup-tutorial.html" title="22.5. High Availability setup tutorial">Section 22.5, “High Availability setup tutorial”</a>.</p><p>Note that while the HA version of Neo4j supports the same API as the single instance embedded version, it does have additional configuration parameters.
Although there are many parameters, most of them have defaults that should work in most cases.</p><div class="table"><a id="idp15446736"></a><p class="title"><strong>HA configuration parameters</strong></p><div class="table-contents"><table summary="HA configuration parameters" cellspacing="0" cellpadding="0" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Parameter Name        </th><th align="left" valign="top"> Description                                     </th><th align="left" valign="top"> Example value  </th><th align="left" valign="top"> Required?</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">ha.server_id</code></p></td><td align="left" valign="top"><p>integer &gt;= 0 and has to be unique in the cluster</p></td><td align="left" valign="top"><p><code class="literal">1</code></p></td><td align="left" valign="top"><p>yes</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.server</code></p></td><td align="left" valign="top"><p>(auto-discovered) host &amp; port to bind when acting as master</p></td><td align="left" valign="top"><p><code class="literal">my-domain.com:6001</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.discovery.enabled</code></p></td><td align="left" valign="top"><p>whether or not to use the resource of ha.discovery.url to define the cluster</p></td><td align="left" valign="top"><p><code class="literal">true</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.discovery.url</code></p></td><td align="left" valign="top"><p>if ha.discovery.enabled is true, used to define the cluster</p></td><td align="left" valign="top"><p><code class="literal"><a class="ulink" href="file://my.server:8080/my-cluster" target="_top">file://my.server:8080/my-cluster</a></code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.initial_hosts</code></p></td><td align="left" valign="top"><p>if ha.discovery.enabled is false, a comma-separated list of other members of the cluster to join. If no members are reachable a new cluster will be created.</p></td><td align="left" valign="top"><p><code class="literal">my-server:5001</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.cluster_server</code></p></td><td align="left" valign="top"><p>(auto-discovered) host &amp; port to bind the cluster management communication</p></td><td align="left" valign="top"><p><code class="literal"></code></p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.pull_interval</code></p></td><td align="left" valign="top"><p>interval for, as slave, pulling updates from the master. Default is to not pull updates regularly, only during write transactions</p></td><td align="left" valign="top"><p><code class="literal">30s or 1500ms</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.read_timeout</code></p></td><td align="left" valign="top"><p>how long a slave will wait for response from master before giving up (default 20)</p></td><td align="left" valign="top"><p><code class="literal">20</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.lock_read_timeout</code></p></td><td align="left" valign="top"><p>how long a slave lock acquisition request will wait for response from master before giving up (defaults to what ha.read_timeout is, or its default if absent)</p></td><td align="left" valign="top"><p><code class="literal">40</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.state_switch_timeout</code></p></td><td align="left" valign="top"><p>how long max time to gracefully await a slave/master role switch</p></td><td align="left" valign="top"><p><code class="literal">20s</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.max_concurrent_channels_per_slave</code></p></td><td align="left" valign="top"><p>max number of concurrent communication channels each slave has to its master. Increase if there’s high contention on few nodes</p></td><td align="left" valign="top"><p><code class="literal">100</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.branched_data_policy</code></p></td><td align="left" valign="top"><p>what to do with the db that is considered branched and will be replaced with a fresh copy from the master {keep_all(default),keep_last,keep_none,shutdown}</p></td><td align="left" valign="top"><p><code class="literal">keep_none</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.tx_push_factor</code></p></td><td align="left" valign="top"><p>amount of slaves the master will push each committed transaction to</p></td><td align="left" valign="top"><p><code class="literal">1 (default)</code></p></td><td align="left" valign="top"><p>no</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ha.tx_push_strategy</code></p></td><td align="left" valign="top"><p>the strategy for selecting which slaves to push committed transactions to. "fixed" (default) will push to slaves with descending server_id order; "round_robin" will have slaves take turn receiving the transactions</p></td><td align="left" valign="top"><p><code class="literal">fixed</code></p></td><td align="left" valign="top"><p>no</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/admon/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that the <code class="literal">org.neo4j.server.database.mode</code> setting in the <span class="emphasis"><em>neo4j-server.properties</em></span> file has to be set to <code class="literal">HA</code> to run Neo4j in High Availability mode.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_different_methods_for_participating_in_a_cluster"></a>22.2.2. Different methods for participating in a cluster</h3></div></div></div><p>There are currently multiple ways of telling your database instance which cluster to create/join, different ways for different occasions.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_knowing_at_least_one_other_member"></a>Knowing at least one other member</h4></div></div></div><p>A database instance can join a cluster by supplying <code class="literal">ha.initial_hosts</code> a comma-separated list of URLs to at least one other cluster member of the cluster to join.
It’s called initial hosts since it’s only for joining the cluster. After an instance joins it gets aware of all the members of the cluster.
It will take turn contacting each one in the list until it gets a response, where it will await a decision by the existing cluster members to have it join.
If it cannot contact any of the members in the URL list it will create a new cluster with itself as master.
This option requires <code class="literal">ha.discovery.enabled</code> be set to <code class="literal">false</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_discovery"></a>Discovery</h4></div></div></div><p>A database instance can point to URL acting as a live list of members in a cluster, by setting <code class="literal">ha.discovery.url</code> to a valid and accessible URL.
If the resource pointed out by that URL exists it will take turn contacting each member in that list until it gets a response, where it will await a decision by the existing cluster members to have it join.
If the resource pointed out by the discovery URL doesn’t exist it will create it and with it a cluster having itself as initial master.
This option requires <code class="literal">ha.discovery.enabled</code> be set to <code class="literal">true</code>.</p></div></div></div><HR xmlns=""></HR><a xmlns="" href="ln-idp1051392.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2012 Neo Technology</p></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ha-architecture.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ha.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ha-how.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
